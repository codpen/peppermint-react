{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/japot/Desktop/Peppermint/Peppermint/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/japot/Desktop/Peppermint/Peppermint/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/japot/Desktop/Peppermint/Peppermint/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Space,Button}from\"antd\";import fileDownload from\"js-file-download\";import axios from\"axios\";import{FileTwoTone,MinusCircleTwoTone,UploadOutlined}from\"@ant-design/icons\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var File=function File(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),files=_useState2[0],setFiles=_useState2[1];function getFiles(){return _getFiles.apply(this,arguments);}function _getFiles(){_getFiles=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var id;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:id=props.ticket.id;_context2.next=3;return fetch(\"/api/v1/tickets/file/listFiles/\".concat(id),{method:\"get\",headers:{\"Content-Type\":\"application/json\"}}).then(function(res){return res.json();}).then(function(res){if(res.files.length!==0){setFiles(res.files);}else{console.log('No files');}});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return _getFiles.apply(this,arguments);}function deleteFile(_x){return _deleteFile.apply(this,arguments);}function _deleteFile(){_deleteFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"/api/v1/tickets/file/del\",{method:\"post\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({file:file.id,ticket:props.ticket.id,path:file.path})}).then(function(res){return res.json();}).then(function(res){console.log(res);if(res.files.length!==0){setFiles(res.files);}else{setFiles(null);}});case 2:case\"end\":return _context3.stop();}}},_callee3);}));return _deleteFile.apply(this,arguments);}function download(file){var url=\"/api/v1/tickets/file/download\";var data=new FormData();data.append(\"filepath\",file.path);axios.post(url,data,{responseType:\"blob\"}).then(function(res){fileDownload(res.data,file.filename);});}useEffect(function(){getFiles();},[]);console.log(files);return/*#__PURE__*/_jsxs(\"div\",{className:files?'':'hidden',children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Files attached to job\"}),files?files.map(function(file){return/*#__PURE__*/_jsx(\"div\",{className:\"todo-list\",children:/*#__PURE__*/_jsx(\"ul\",{children:/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(FileTwoTone,{}),/*#__PURE__*/_jsx(\"span\",{children:file.filename}),/*#__PURE__*/_jsx(Button,{ghost:true,style:{float:\"right\"},onClick:function onClick(e){e.stopPropagation();deleteFile(file);},children:/*#__PURE__*/_jsx(MinusCircleTwoTone,{twoToneColor:\"#FF0000\\t\"})}),/*#__PURE__*/_jsx(Button,{ghost:true,onClick:/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.stopPropagation();download(file);case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref.apply(this,arguments);};}(),children:/*#__PURE__*/_jsx(UploadOutlined,{style:{color:\"black\"}})})]})})})},file._id);}):/*#__PURE__*/_jsx(\"p\",{children:\"There are no files here\"})]});};export default File;","map":{"version":3,"sources":["C:/Users/japot/Desktop/Peppermint/Peppermint/client/src/components/ticket/File.js"],"names":["React","useState","useEffect","Space","Button","fileDownload","axios","FileTwoTone","MinusCircleTwoTone","UploadOutlined","File","props","files","setFiles","getFiles","id","ticket","fetch","method","headers","then","res","json","length","console","log","deleteFile","file","body","JSON","stringify","path","download","url","data","FormData","append","post","responseType","filename","map","float","e","stopPropagation","color","_id"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Space, Button } from \"antd\";\r\nimport fileDownload from \"js-file-download\";\r\nimport axios from \"axios\";\r\nimport {\r\n  FileTwoTone,\r\n  MinusCircleTwoTone,\r\n  UploadOutlined,\r\n} from \"@ant-design/icons\";\r\n\r\nconst File = (props) => {\r\n  const [files, setFiles] = useState();\r\n\r\n  async function getFiles() {\r\n    const id = props.ticket.id;\r\n    await fetch(`/api/v1/tickets/file/listFiles/${id}`, {\r\n      method: \"get\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    })\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        if(res.files.length !== 0) {\r\n          setFiles(res.files);\r\n        } else {\r\n          console.log('No files')\r\n        }      \r\n      });\r\n  }\r\n\r\n  async function deleteFile(file) {\r\n    await fetch(`/api/v1/tickets/file/del`, {\r\n      method: \"post\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        file: file.id,\r\n        ticket: props.ticket.id,\r\n        path: file.path,\r\n      }),\r\n    })\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        console.log(res)\r\n        if(res.files.length !== 0) {\r\n          setFiles(res.files);\r\n        } else {\r\n          setFiles(null)\r\n        }  \r\n      });\r\n  }\r\n\r\n  function download(file) {\r\n    const url = `/api/v1/tickets/file/download`;\r\n    let data = new FormData();\r\n    data.append(\"filepath\", file.path);\r\n    axios\r\n      .post(url, data, {\r\n        responseType: \"blob\",\r\n      })\r\n      .then((res) => {\r\n        fileDownload(res.data, file.filename);\r\n      });\r\n  }\r\n\r\n  useEffect(() => {\r\n    getFiles();\r\n  }, []);\r\n\r\n  console.log(files)\r\n\r\n  return (\r\n    <div className={files ? '' : 'hidden'}>\r\n      <h1>Files attached to job</h1>\r\n      {files ? (files.map((file) => {\r\n        return (\r\n          <div className='todo-list' key={file._id}>\r\n            <ul>\r\n              <li>\r\n                <Space>\r\n                  <FileTwoTone />\r\n                  <span>{file.filename}</span>\r\n                  <Button\r\n                    ghost\r\n                    style={{ float: \"right\" }}\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      deleteFile(file);\r\n                    }}\r\n                  >\r\n                    <MinusCircleTwoTone twoToneColor=\"#FF0000\t\" />\r\n                  </Button>\r\n                  <Button\r\n                    ghost\r\n                    onClick={async (e) => {\r\n                      e.stopPropagation();\r\n                      download(file);\r\n                    }}\r\n                  >\r\n                    <UploadOutlined style={{ color: \"black\" }} />\r\n                  </Button>\r\n                </Space>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        );\r\n      })) : (\r\n        <p>There are no files here</p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default File;\r\n"]},"metadata":{},"sourceType":"module"}